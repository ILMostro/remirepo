From 330dd7548652630df103a76fdbca85651fe05123 Mon Sep 17 00:00:00 2001
From: Remi Collet <fedora@famillecollet.com>
Date: Wed, 2 Sep 2015 14:22:27 +0200
Subject: [PATCH 1/2] report extension and library version (phpinfo)

---
 libsmbclient.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/libsmbclient.c b/libsmbclient.c
index 25b32a2..72d36d1 100644
--- a/libsmbclient.c
+++ b/libsmbclient.c
@@ -351,7 +351,8 @@ PHP_MINFO_FUNCTION(smbclient)
 {
 	php_info_print_table_start();
 	php_info_print_table_row(2, "libsmbclient Support", "enabled");
-	php_info_print_table_row(2, "libsmbclient Version", LIBSMBCLIENT_VERSION);
+	php_info_print_table_row(2, "libsmbclient extension Version", LIBSMBCLIENT_VERSION);
+	php_info_print_table_row(2, "libsmbclient library Version", smbc_version());
 	php_info_print_table_end();
 }
 

From 6cce8b9ee3f4302d6eb742a43696782cae6e01c1 Mon Sep 17 00:00:00 2001
From: Remi Collet <fedora@famillecollet.com>
Date: Wed, 2 Sep 2015 14:56:17 +0200
Subject: [PATCH 2/2] add arginfo for reflection

---
 libsmbclient.c | 172 ++++++++++++++++++++++++++++++++++++++++++++++-----------
 1 file changed, 140 insertions(+), 32 deletions(-)

diff --git a/libsmbclient.c b/libsmbclient.c
index 72d36d1..bf0cce0 100644
--- a/libsmbclient.c
+++ b/libsmbclient.c
@@ -149,41 +149,149 @@ hide_password (char *url, int len)
 	astfill(second_colon + 1, at_sign - 1);
 }
 
+/* {{{ arginfo */
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_void, 0)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO_EX(arginfo_smbclient_state_init, 0, 0, 1)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, workgroup)
+	ZEND_ARG_INFO(0, user)
+	ZEND_ARG_INFO(0, password)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_state, 0)
+	ZEND_ARG_INFO(0, state)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_option_get, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, option)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_option_set, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, option)
+	ZEND_ARG_INFO(0, value)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_path, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, path)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_rename, 0)
+	ZEND_ARG_INFO(0, oldstate)
+	ZEND_ARG_INFO(0, oldpath)
+	ZEND_ARG_INFO(0, oldstate)
+	ZEND_ARG_INFO(0, oldpath)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_dir, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, dir)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_file, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, file)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO_EX(arginfo_smbclient_open, 0, 0, 3)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, path)
+	ZEND_ARG_INFO(0, flags)
+	ZEND_ARG_INFO(0, mode)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO_EX(arginfo_smbclient_creat, 0, 0, 2)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, path)
+	ZEND_ARG_INFO(0, mode)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO_EX(arginfo_smbclient_write, 0, 0, 3)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, file)
+	ZEND_ARG_INFO(0, buffer)
+	ZEND_ARG_INFO(0, count)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_lseek, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, file)
+	ZEND_ARG_INFO(0, offset)
+	ZEND_ARG_INFO(0, whence)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_ftruncate, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, file)
+	ZEND_ARG_INFO(0, offset)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_utimes, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, path)
+	ZEND_ARG_INFO(0, mtime)
+	ZEND_ARG_INFO(0, atime)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO(arginfo_smbclient_getxattr, 0)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, path)
+	ZEND_ARG_INFO(0, name)
+ZEND_END_ARG_INFO()
+
+ZEND_BEGIN_ARG_INFO_EX(arginfo_smbclient_setxattr, 0, 0, 4)
+	ZEND_ARG_INFO(0, state)
+	ZEND_ARG_INFO(0, path)
+	ZEND_ARG_INFO(0, name)
+	ZEND_ARG_INFO(0, value)
+	ZEND_ARG_INFO(0, flags)
+ZEND_END_ARG_INFO()
+
+/* }}} */
+
 static zend_function_entry libsmbclient_functions[] =
 {
-	PHP_FE(smbclient_version, NULL)
-	PHP_FE(smbclient_library_version, NULL)
-	PHP_FE(smbclient_state_new, NULL)
-	PHP_FE(smbclient_state_init, NULL)
-	PHP_FE(smbclient_state_errno, NULL)
-	PHP_FE(smbclient_state_free, NULL)
-	PHP_FE(smbclient_option_get, NULL)
-	PHP_FE(smbclient_option_set, NULL)
-	PHP_FE(smbclient_opendir, NULL)
-	PHP_FE(smbclient_readdir, NULL)
-	PHP_FE(smbclient_closedir, NULL)
-	PHP_FE(smbclient_stat, NULL)
-	PHP_FE(smbclient_fstat, NULL)
-	PHP_FE(smbclient_open, NULL)
-	PHP_FE(smbclient_creat, NULL)
-	PHP_FE(smbclient_read, NULL)
-	PHP_FE(smbclient_close, NULL)
-	PHP_FE(smbclient_mkdir, NULL)
-	PHP_FE(smbclient_rmdir, NULL)
-	PHP_FE(smbclient_rename, NULL)
-	PHP_FE(smbclient_write, NULL)
-	PHP_FE(smbclient_unlink, NULL)
-	PHP_FE(smbclient_lseek, NULL)
-	PHP_FE(smbclient_ftruncate, NULL)
-	PHP_FE(smbclient_chmod, NULL)
-	PHP_FE(smbclient_utimes, NULL)
-	PHP_FE(smbclient_listxattr, NULL)
-	PHP_FE(smbclient_getxattr, NULL)
-	PHP_FE(smbclient_setxattr, NULL)
-	PHP_FE(smbclient_removexattr, NULL)
-	PHP_FE(smbclient_statvfs, NULL)
-	PHP_FE(smbclient_fstatvfs, NULL)
+	PHP_FE(smbclient_version, arginfo_smbclient_void)
+	PHP_FE(smbclient_library_version, arginfo_smbclient_void)
+	PHP_FE(smbclient_state_new, arginfo_smbclient_void)
+	PHP_FE(smbclient_state_init, arginfo_smbclient_state_init)
+	PHP_FE(smbclient_state_errno, arginfo_smbclient_state)
+	PHP_FE(smbclient_state_free, arginfo_smbclient_state)
+	PHP_FE(smbclient_option_get, arginfo_smbclient_option_get)
+	PHP_FE(smbclient_option_set, arginfo_smbclient_option_set)
+	PHP_FE(smbclient_opendir, arginfo_smbclient_path)
+	PHP_FE(smbclient_readdir, arginfo_smbclient_dir)
+	PHP_FE(smbclient_closedir, arginfo_smbclient_dir)
+	PHP_FE(smbclient_stat, arginfo_smbclient_path)
+	PHP_FE(smbclient_fstat, arginfo_smbclient_file)
+	PHP_FE(smbclient_open, arginfo_smbclient_open)
+	PHP_FE(smbclient_creat, arginfo_smbclient_creat)
+	PHP_FE(smbclient_read, arginfo_smbclient_file)
+	PHP_FE(smbclient_close, arginfo_smbclient_file)
+	PHP_FE(smbclient_mkdir, arginfo_smbclient_creat)
+	PHP_FE(smbclient_rmdir, arginfo_smbclient_path)
+	PHP_FE(smbclient_rename, arginfo_smbclient_rename)
+	PHP_FE(smbclient_write, arginfo_smbclient_write)
+	PHP_FE(smbclient_unlink, arginfo_smbclient_path)
+	PHP_FE(smbclient_lseek, arginfo_smbclient_lseek)
+	PHP_FE(smbclient_ftruncate, arginfo_smbclient_ftruncate)
+	PHP_FE(smbclient_chmod, arginfo_smbclient_creat)
+	PHP_FE(smbclient_utimes, arginfo_smbclient_utimes)
+	PHP_FE(smbclient_listxattr, arginfo_smbclient_path)
+	PHP_FE(smbclient_getxattr, arginfo_smbclient_getxattr)
+	PHP_FE(smbclient_setxattr, arginfo_smbclient_setxattr)
+	PHP_FE(smbclient_removexattr, arginfo_smbclient_getxattr)
+	PHP_FE(smbclient_statvfs, arginfo_smbclient_path)
+	PHP_FE(smbclient_fstatvfs, arginfo_smbclient_file)
+#ifdef PHP_FE_END
+	PHP_FE_END
+#else
 	{NULL, NULL, NULL}
+#endif
 };
 
 zend_module_entry libsmbclient_module_entry =
